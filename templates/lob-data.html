{% extends "layout.html" %}

{% block title %}
    Line of Balance
{% endblock %}

{% block main %}
    <canvas id="lobChart" width="400" height="200"></canvas>
    <script>
        fetch('/lob-data')
            .then(response => response.json())
            .then(data => {
                console.log(data); // Add this for debugging

                if (data.length === 0) {
                    alert("No data available");
                    return;
                }

                // Process the data to extract labels and datasets
                let locations = [];
                let tasks = {};

                data.forEach(row => {
                    if (!locations.includes(row.location)) {
                        locations.push(row.location);
                    }

                    if (!tasks[row.task]) {
                        tasks[row.task] = {
                            label: row.task,
                            data: []
                        };
                    }

                    tasks[row.task].data.push({
                        x: new Date(row.start_time),
                        y: row.location_order
                    });

                    tasks[row.task].data.push({
                        x: new Date(row.end_time),
                        y: row.location_order
                    });
                });

                let datasets = Object.keys(tasks).map(task => tasks[task]);

                const ctx = document.getElementById('lobChart').getContext('2d');
                const sampleData = [
                    {
                        label: 'Task A',
                        data: [
                            { x: 0, y: 1 },
                            { x: 10, y: 2 },
                            { x: 20, y: 3 }
                        ],
                        fill: false,
                        borderColor: 'blue',
                        tension: 0.1
                    }
                ];

                const lobChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        datasets: sampleData
                    },
                    options: {
                        scales: {
                            x: {
                                type: 'linear',
                                title: {
                                    display: true,
                                    text: 'Time'
                                }
                            },
                            y: {
                                type: 'linear',
                                title: {
                                    display: true,
                                    text: 'Location'
                                }
                            }
                        }
                    }
                });
            });
    </script>
{% endblock %}
